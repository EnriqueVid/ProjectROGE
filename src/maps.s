INCLUDE "src/maps.h.s"

SECTION "Maps_Variables", WRAM0

_win:             ds $01

_mActual_X:       ds $01
_mActual_Y:       ds $01
scroll:           ds $01
scrollCounter:    ds $01
scrollDirectionX: ds $01
scrollDirectionY: ds $01

;scrollPositionX:  ds $01
;scrollPositionY:  ds $01

;;SCROLL MAP VARIABLES
GBS_tilemap_x:      ds $01  ;;posicion X de la panralla en el tilemap
GBS_tilemap_y:      ds $01  ;;posicion Y de la pantalla en el tilemap

GBS_tilemap_pl:     ds $01  ;;puntero a la posicion en el tilemap (low)
GBS_tilemap_ph:     ds $01  ;;puntero a la posicion en el tilemap (high)

GBS_map_tl_pl:         ds $01  ;;puntero a la posicion en el screen_map (low)
GBS_map_tl_ph:         ds $01  ;;puntero a la posicion en el screen_map (high)

GBS_map_tr_pl:         ds $01  ;;puntero a la posicion en el screen_map (low)
GBS_map_tr_ph:         ds $01  ;;puntero a la posicion en el screen_map (high)

GBS_map_bl_pl:         ds $01  ;;puntero a la posicion en el screen_map (low)
GBS_map_bl_ph:         ds $01  ;;puntero a la posicion en el screen_map (high)

;mapLoadIncrement: ds $01


SECTION "Maps", ROM0

_mapa_Prueba_01::
    db $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01
    db $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01
    db $01, $01, $01, $00, $00, $00, $01, $02, $00, $01, $00, $00, $00, $00, $01, $01
    db $01, $01, $01, $00, $00, $00, $01, $00, $00, $01, $00, $00, $00, $00, $01, $01
    db $01, $01, $01, $00, $00, $00, $01, $00, $00, $01, $00, $00, $00, $00, $01, $01
    db $01, $01, $01, $00, $00, $00, $01, $00, $00, $00, $00, $00, $00, $00, $01, $01
    db $01, $01, $01, $01, $00, $01, $01, $00, $00, $01, $00, $00, $00, $00, $01, $01
    db $01, $01, $01, $01, $00, $01, $01, $00, $00, $01, $00, $00, $00, $00, $01, $01
    db $01, $01, $01, $00, $00, $00, $01, $00, $00, $01, $00, $00, $00, $00, $01, $01
    db $01, $01, $01, $00, $00, $00, $01, $01, $01, $01, $00, $00, $00, $00, $01, $01
    db $01, $01, $01, $00, $00, $00, $01, $01, $01, $01, $00, $00, $00, $00, $01, $01
    db $01, $01, $01, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $01, $01
    db $01, $01, $01, $00, $00, $00, $01, $01, $01, $01, $00, $00, $00, $00, $01, $01
    db $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01
    db $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01
    db $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01
_mapa_Prueba_01_end:


_mapa_Prueba_02::
    db $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01
    db $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01
    db $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01
    db $01, $01, $01, $01, $06, $02, $02, $02, $02, $02, $02, $02, $02, $02, $02, $02, $02, $02, $02, $02, $02, $02, $02, $02, $02, $07, $01, $01, $01, $01
    db $01, $01, $01, $01, $04, $0A, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $05, $01, $01, $01, $01
    db $01, $01, $01, $01, $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $05, $01, $01, $01, $01
    db $01, $01, $01, $01, $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $05, $01, $01, $01, $01
    db $01, $01, $01, $01, $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $05, $01, $01, $01, $01
    db $01, $01, $01, $01, $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $05, $01, $01, $01, $01
    db $01, $01, $01, $01, $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $05, $01, $01, $01, $01
    db $01, $01, $01, $01, $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $05, $01, $01, $01, $01
    db $01, $01, $01, $01, $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $05, $01, $01, $01, $01
    db $01, $01, $01, $01, $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $05, $01, $01, $01, $01
    db $01, $01, $01, $01, $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $05, $01, $01, $01, $01
    db $01, $01, $01, $01, $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $05, $01, $01, $01, $01
    db $01, $01, $01, $01, $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $05, $01, $01, $01, $01
    db $01, $01, $01, $01, $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $05, $01, $01, $01, $01
    db $01, $01, $01, $01, $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $05, $01, $01, $01, $01
    db $01, $01, $01, $01, $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $05, $01, $01, $01, $01
    db $01, $01, $01, $01, $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $05, $01, $01, $01, $01
    db $01, $01, $01, $01, $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $05, $01, $01, $01, $01
    db $01, $01, $01, $01, $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $05, $01, $01, $01, $01
    db $01, $01, $01, $01, $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $05, $01, $01, $01, $01
    db $01, $01, $01, $01, $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $05, $01, $01, $01, $01
    db $01, $01, $01, $01, $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $05, $01, $01, $01, $01
    db $01, $01, $01, $01, $04, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $05, $01, $01, $01, $01
    db $01, $01, $01, $01, $08, $03, $03, $03, $03, $03, $03, $03, $03, $03, $03, $03, $03, $03, $03, $03, $03, $03, $03, $03, $03, $09, $01, $01, $01, $01
    db $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01
    db $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01
    db $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01
_mapa_Prueba_02_end:




;;========================================================================================
;;                                  SET SCROLL SCREEN
;;----------------------------------------------------------------------------------------
;; Setea la pantalla para realizar el scroll
;;
;; INPUT: 
;;  B -> Direccion en X (+1 / -1)
;;  C -> Direccion en Y (+1 / -1)
;;
;; OUTPUT: 
;;  NONE
;;
;; DELETES: 
;;  AF
;;
;;========================================================================================
_set_scroll_screen:

    ld a, scrollConst
    ld [scroll], a
    ld a, b
    ld [scrollDirectionX], a
    ld a, c
    ld [scrollDirectionY], a

    ret



;;========================================================================================
;;                                     UPDATE SCROLL
;;----------------------------------------------------------------------------------------
;; Mueve la pantalla en la direccion establecida en _set_scroll_screen
;;
;; INPUT:
;;  NONE
;;
;; OUTPUT:
;;  NONE
;;
;; DELETES: 
;;  AF, BC, HL
;;
;;========================================================================================
_update_scroll:

    ld a, [scroll]
    cp $0
    ret z
    push af

    ld a, [scrollCounter]
    cp $0
    jr nz, .end_update_scroll
        ld a, scrollCounterConst
        ld [scrollCounter], a

        call _wait_Vblank
        ld hl,$FF42				;; FF42 - FF43  -->  Tile scroll X, Y
		ld a, [hl]
		ld b, a
        ld a, [scrollDirectionY]
        add b
		ldi	[hl], a				;; FF42: SCY --> Tile Scroll Y  |
    	ld a, [hl]
        ld b, a
        ld a, [scrollDirectionX]
        add b
		ld	[hl], a				;; FF43: SCX --> Tile Scroll X  +- Setea el scroll de la pantalla a [0, 0]

        ld a, [_enemy_dead]
        cp $00
        jr nz, .continue
        call _move_view_enemy
        call _update_enemy_view_position
.continue:
        pop af
        dec a
        ld [scroll], a

        ret

    
.end_update_scroll:
    dec a
    ld [scrollCounter], a

    pop af
    ret